Object subclass: #SADAbstractScope	instanceVariableNames: ''	classVariableNames: ''	poolDictionaries: ''	category: 'SAD-Scopes and Environment'!!SADAbstractScope methodsFor: 'testing' stamp: 'jws 11/7/2025 12:51'!hasBinding: aName	self subclassResponsibility! !!SADAbstractScope methodsFor: 'accessing' stamp: 'jws 11/7/2025 12:50'!bind: aNameto: aValue	self subclassResponsibility! !!SADAbstractScope methodsFor: 'accessing' stamp: 'jws 11/7/2025 12:51'!bindingFor: aName	self subclassResponsibility! !Object subclass: #SADEnvironment	instanceVariableNames: 'variableScope methodScope activations'	classVariableNames: ''	poolDictionaries: ''	category: 'SAD-Scopes and Environment'!!SADEnvironment methodsFor: 'initialize-release' stamp: 'jws 11/13/2025 12:40'!initialize	super initialize.	variableScope := SADScope globalScope.	methodScope := SADScope globalScope.	activations := OrderedCollection new.! !!SADEnvironment methodsFor: 'accessing' stamp: 'WB 11/14/2025 16:52'!activate	activations addLast: self variableScope.	self variableScope: (SADScope newScopeIn: self globalScope).! !!SADEnvironment methodsFor: 'accessing' stamp: 'jws 11/13/2025 12:28'!activations	^ activations! !!SADEnvironment methodsFor: 'accessing' stamp: 'jws 11/13/2025 12:28'!activations: anObject	activations := anObject.! !!SADEnvironment methodsFor: 'accessing' stamp: 'WB 11/15/2025 14:43'!deactivate	self variableScope: (self activations removeLast).! !!SADEnvironment methodsFor: 'accessing' stamp: 'WB 11/14/2025 13:37'!declare: aName method: aMethod	methodScope bind: aName to: aMethod.! !!SADEnvironment methodsFor: 'accessing' stamp: 'WB 11/14/2025 13:29'!declare: aName variable: aVariable	self variableScope 	bind: aName 	to: aVariable.! !!SADEnvironment methodsFor: 'accessing' stamp: 'WB 11/15/2025 14:41'!globalScope	(self 	activations isEmpty)	ifTrue: [^self variableScope] 	 ifFalse: [^activations at: 1].! !!SADEnvironment methodsFor: 'accessing' stamp: 'WB 11/14/2025 13:38'!methodNamed: aName	^self methodScope bindingFor: aName.! !!SADEnvironment methodsFor: 'accessing' stamp: 'jws 11/13/2025 12:28'!methodScope	^ methodScope! !!SADEnvironment methodsFor: 'accessing' stamp: 'jws 11/13/2025 12:28'!methodScope: anObject	methodScope := anObject.! !!SADEnvironment methodsFor: 'accessing' stamp: 'WB 11/14/2025 13:34'!variableNamed: aName		^self variableScope bindingFor: aName.! !!SADEnvironment methodsFor: 'accessing' stamp: 'jws 11/13/2025 12:28'!variableScope	^ variableScope! !!SADEnvironment methodsFor: 'accessing' stamp: 'jws 11/13/2025 12:28'!variableScope: anObject	variableScope := anObject.! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!SADEnvironment class	instanceVariableNames: 'globalScope'!TestCase subclass: #SADEnvironmentTestCase	instanceVariableNames: 'env'	classVariableNames: ''	poolDictionaries: ''	category: 'SAD-Scopes and Environment'!!SADEnvironmentTestCase methodsFor: 'running' stamp: 'jws 11/13/2025 14:03'!testActivation	env declare: 'winkin' variable: 7.	env activate.	self		assert: 7		equals: (env variableNamed: 'winkin').	env declare: 'winkin' variable: 9.	self 		assert: 9		equals: (env variableNamed: 'winkin').	env declare: 'blinkin' variable: 13.	self 		assert: 13		equals: (env variableNamed: 'blinkin').	env deactivate.	self		assert: 7		equals: (env variableNamed: 'winkin').	self		should: [env variableNamed: 'blinkin']		raise: SADUndeclaredError.! !!SADEnvironmentTestCase methodsFor: 'running' stamp: 'jws 11/13/2025 12:33'!testConstructor	self assert: env activations isEmpty.	self assert: (env variableScope isKindOf: SADScope).	self assert: (env methodScope isKindOf: SADScope).! !!SADEnvironmentTestCase methodsFor: 'running' stamp: 'jws 11/13/2025 13:58'!testMethods	| method1 method2 |	self		should: [env methodNamed: 'xlerb']		raise: SADUndeclaredError.	method1 := 'I am a method'.	env declare: 'xlerb' method: method1.	self 		should: [env declare: 'xlerb' method: 'I am another method.']		raise: SADMultipleDeclarationError.	method2 := env methodNamed: 'xlerb'.	self assert: (method1 == method2).	self 		should: [env variableNamed: 'xlerb']		raise: SADUndeclaredError.	! !!SADEnvironmentTestCase methodsFor: 'running' stamp: 'jws 11/13/2025 13:33'!testVariables	| var1 var2 |	self		should: [env variableNamed: 'fnord']		raise: SADUndeclaredError.	var1 := SADVariable integer.	env declare: 'fnord' variable: var1.	self 		should: [env declare: 'fnord' variable: SADVariable string]		raise: SADMultipleDeclarationError.	var2 := env variableNamed: 'fnord'.	self assert: (var1 == var2).	self 		should: [env methodNamed: 'fnord']		raise: SADUndeclaredError.	! !!SADEnvironmentTestCase methodsFor: 'initialize-release' stamp: 'jws 11/13/2025 12:30'!setUp	super setUp.	env := SADEnvironment new! !SADAbstractScope subclass: #SADScope	instanceVariableNames: 'outerScope bindings'	classVariableNames: ''	poolDictionaries: ''	category: 'SAD-Scopes and Environment'!!SADScope methodsFor: 'initialize-release' stamp: 'jws 11/13/2025 12:46'!initialize	super initialize.	outerScope := SADVoidScope default.	bindings := Dictionary new.! !!SADScope methodsFor: 'testing' stamp: 'jws 11/12/2025 12:50'!hasBinding: aName	^(self bindings includesKey: aName) or: [self outerScope hasBinding: aName]! !!SADScope methodsFor: 'accessing' stamp: 'WB 11/14/2025 13:12'!bind: aNameto: aValue	(self bindings includesKey: aName)		ifTrue: [SADMultipleDeclarationError signal]		ifFalse: [self bindings at: aName put: aValue].	! !!SADScope methodsFor: 'accessing' stamp: 'WB 11/14/2025 12:53'!bindingFor: aName	^self bindings 		at: aName 		ifAbsent: [self outerScope bindingFor: aName].! !!SADScope methodsFor: 'accessing' stamp: 'WB 11/14/2025 12:41'!bindings	^ bindings! !!SADScope methodsFor: 'accessing' stamp: 'WB 11/14/2025 12:41'!bindings: anObject	bindings := anObject.! !!SADScope methodsFor: 'accessing' stamp: 'WB 11/14/2025 12:41'!outerScope	^ outerScope! !!SADScope methodsFor: 'accessing' stamp: 'WB 11/14/2025 12:41'!outerScope: anObject	outerScope := anObject.! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!SADScope class	instanceVariableNames: ''!!SADScope class methodsFor: 'instance creation' stamp: 'jws 11/13/2025 12:42'!globalScope		^self new! !!SADScope class methodsFor: 'initialize-release' stamp: 'WB 11/14/2025 13:19'!newScopeIn: aSADScope 	^self new		outerScope: aSADScope.	! !TestCase subclass: #SADScopeTestCase	instanceVariableNames: 'globalScope'	classVariableNames: ''	poolDictionaries: ''	category: 'SAD-Scopes and Environment'!!SADScopeTestCase methodsFor: 'running' stamp: 'jws 11/10/2025 12:41'!testGlobalScope	self deny: (self globalScope hasBinding: 'theAnswer').	self 		should: [self globalScope bindingFor: 'theAnswer']		raise: SADUndeclaredError.	self globalScope bind: 'theAnswer' to: 42.	self assert: (self globalScope hasBinding: 'theAnswer').	self		assert: 42		equals: (self globalScope bindingFor: 'theAnswer').	self		should: [self globalScope bind: 'theAnswer' to: 9]		raise: SADMultipleDeclarationError! !!SADScopeTestCase methodsFor: 'running' stamp: 'jws 11/12/2025 12:32'!testNestedScopes	| innerScope middleScope |	middleScope := SADScope newScopeIn: self globalScope.	innerScope := SADScope newScopeIn: middleScope.	self globalScope		bind: 'foo' to: 7;		bind: 'fubar' to: nil.	middleScope 		bind: 'foo' to: 'hi'.	innerScope		bind: 'foo' to: $A;		bind: 'fubar' to: 'no';		bind: 'baz' to: 'xanadu'.	self 		assert: 7		equals: (globalScope bindingFor: 'foo').	self 		assert: 'hi'		equals: (middleScope bindingFor: 'foo').	self 		assert: $A		equals: (innerScope bindingFor: 'foo').	self 		assert: nil		equals: (globalScope bindingFor: 'fubar').	self 		assert: nil		equals: (middleScope bindingFor: 'fubar').	self 		assert: 'no'		equals: (innerScope bindingFor: 'fubar').	self		assert: 'xanadu'		equals: (innerScope bindingFor: 'baz').	self assert: (innerScope hasBinding: 'baz').	self		should: [middleScope bindingFor: 'baz']		raise: SADUndeclaredError.	self deny: (middleScope hasBinding: 'baz').	self deny: (innerScope hasBinding: 'xlerb').! !!SADScopeTestCase methodsFor: 'running' stamp: 'jws 11/10/2025 12:33'!testVoidScope	| voidScope |	voidScope := SADVoidScope default.	self		should: [voidScope bind: 'john' to: SADVariable string]		raise: SADError.	self deny: (voidScope hasBinding: 'john').	self		should: [voidScope bindingFor: 'john']		raise: SADUndeclaredError.! !!SADScopeTestCase methodsFor: 'initialize-release' stamp: 'jws 11/10/2025 12:33'!setUp	super setUp.	globalScope := SADScope globalScope.! !!SADScopeTestCase methodsFor: 'accessing' stamp: 'jws 11/10/2025 12:21'!globalScope	^ globalScope! !!SADScopeTestCase methodsFor: 'accessing' stamp: 'jws 11/10/2025 12:21'!globalScope: anObject	globalScope := anObject.! !SADAbstractScope subclass: #SADVoidScope	instanceVariableNames: ''	classVariableNames: ''	poolDictionaries: ''	category: 'SAD-Scopes and Environment'!!SADVoidScope methodsFor: 'testing' stamp: 'WB 11/15/2025 14:45'!hasBinding: aName	^ false.! !!SADVoidScope methodsFor: 'accessing' stamp: 'WB 11/14/2025 12:57'!bind: aNameto: aValue	SADError signal.! !!SADVoidScope methodsFor: 'accessing' stamp: 'WB 11/14/2025 12:32'!bindingFor: aName	SADUndeclaredError signal.! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!SADVoidScope class	instanceVariableNames: 'default'!!SADVoidScope class methodsFor: 'accessing' stamp: 'WB 11/14/2025 12:14'!default	default isNil ifTrue: [default := self new].	^default! !