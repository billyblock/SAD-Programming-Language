Object subclass: #SADSemanticAnalyzer	instanceVariableNames: 'env errors remaps'	classVariableNames: ''	poolDictionaries: ''	category: 'SAD-SemanticAnalyzer'!!SADSemanticAnalyzer methodsFor: 'initialize-release' stamp: 'WB 12/4/2025 12:16'!initialize	super initialize.	env := SADEnvironment new.	errors := OrderedCollection new.! !!SADSemanticAnalyzer methodsFor: 'accessing' stamp: 'WB 12/4/2025 12:18'!env	^ env! !!SADSemanticAnalyzer methodsFor: 'accessing' stamp: 'WB 12/4/2025 12:18'!env: anObject	env := anObject.! !!SADSemanticAnalyzer methodsFor: 'accessing' stamp: 'WB 12/4/2025 12:18'!errors	^ errors! !!SADSemanticAnalyzer methodsFor: 'accessing' stamp: 'WB 12/4/2025 12:18'!errors: anObject	errors := anObject.! !!SADSemanticAnalyzer methodsFor: 'error reporting' stamp: 'WB 12/4/2025 12:43'!recordError: aSADError	self errors add: aSADError.! !!SADSemanticAnalyzer methodsFor: 'visiting' stamp: 'WB 12/4/2025 15:37'!apply: args to: params 		| argStream paramStream |	argStream := ReadStream on: args.	paramStream := ReadStream on: params.	[paramStream atEnd]		whileFalse:			[paramStream next set: argStream next]! !!SADSemanticAnalyzer methodsFor: 'visiting' stamp: 'WB 12/4/2025 15:36'!visitSADArgumentList: aSADArgumentList 		^aSADArgumentList arguments 		collect: 			[:each | each accept: self]! !!SADSemanticAnalyzer methodsFor: 'visiting' stamp: 'WB 12/4/2025 16:14'!visitSADArithmeticOp: aSADArithmeticOp 		^aSADArithmeticOp symbol.! !!SADSemanticAnalyzer methodsFor: 'visiting' stamp: 'WB 12/5/2025 08:57'!visitSADAssignment: aSADAssignment 		| var expr |	expr := aSADAssignment expression accept: self.	[var := self env variableNamed: aSADAssignment identifier]		on: SADError		do: [:ex|			self recordError: ex.			var := SADVariable new type: SADErrorType new].	[var set: expr]		on: SADError		do: [:ex| 			self recordError: ex]! !!SADSemanticAnalyzer methodsFor: 'visiting' stamp: 'WB 12/8/2025 13:04'!visitSADBinaryExpression: aSADBinaryExpression 	| arg1 arg2 |	arg1 := aSADBinaryExpression arg1 accept: self.	arg2 := aSADBinaryExpression arg2 accept: self.	[aSADBinaryExpression op checkOp: arg1 and: arg2]		on: SADError		do: [:ex |				self recordError: ex.].	^ aSADBinaryExpression op default.! !!SADSemanticAnalyzer methodsFor: 'visiting' stamp: 'WB 12/4/2025 15:34'!visitSADBlockStatement: aSADBlockStatement 	aSADBlockStatement statements		do:			[:each | each accept: self]! !!SADSemanticAnalyzer methodsFor: 'visiting' stamp: 'WB 12/4/2025 16:37'!visitSADFunction: aSADFunction 		[self env		declare: aSADFunction identifier		method: aSADFunction]	on: SADError	do: [:ex | self recordError: ex].! !!SADSemanticAnalyzer methodsFor: 'visiting' stamp: 'WB 12/4/2025 15:35'!visitSADFunctionCall: aSADFunctionCall 		| func funcName args params returnVar |	args := aSADFunctionCall arguments accept: self.	func := self env methodNamed: aSADFunctionCall identifier.	funcName := func identifier.	self env activate.	returnVar := SADVariable type: (func returnType accept: self).	self env declare: funcName variable: returnVar.	params := func parameters accept: self.	self apply: args to: params.	func methodBody accept: self.	self env deactivate.	^returnVar get.! !!SADSemanticAnalyzer methodsFor: 'visiting' stamp: 'WB 12/8/2025 11:59'!visitSADGroupExpression: aSADGroupExpression 		^aSADGroupExpression expression accept: self.! !!SADSemanticAnalyzer methodsFor: 'visiting' stamp: 'WB 12/4/2025 16:30'!visitSADIOStatement: aSADIOStatement 	"This intitially doesn't do anything"	^self! !!SADSemanticAnalyzer methodsFor: 'visiting' stamp: 'WB 12/4/2025 12:39'!visitSADIOWriteNewLineStatement: aSADIOWriteNewLineStatement 	"this method intitially does nothing."	^self.! !!SADSemanticAnalyzer methodsFor: 'visiting' stamp: 'WB 12/8/2025 13:22'!visitSADIfThenElseStatement: aSADIfThenElseStatement 	^(aSADIfThenElseStatement expression accept: self)		ifTrue: [aSADIfThenElseStatement trueStatement accept: self]		ifFalse: [aSADIfThenElseStatement falseStatement accept: self]! !!SADSemanticAnalyzer methodsFor: 'visiting' stamp: 'WB 12/5/2025 16:28'!visitSADIfThenStatement: aSADIfThenStatement 		[(aSADIfThenStatement expression accept: self)		ifTrue: [aSADIfThenStatement trueStatement accept: self]]	on: NonBooleanReceiver	do: [:ex | self recordError: ex ]! !!SADSemanticAnalyzer methodsFor: 'visiting' stamp: 'WB 12/4/2025 15:37'!visitSADMethodBody: aSADMethodBody 		aSADMethodBody variables accept: self.	aSADMethodBody statement accept: self.! !!SADSemanticAnalyzer methodsFor: 'visiting' stamp: 'WB 12/4/2025 12:36'!visitSADMethods: aSADMethods 		aSADMethods methods		do:			[:each | each accept: self]! !!SADSemanticAnalyzer methodsFor: 'visiting' stamp: 'WB 12/4/2025 15:37'!visitSADParameterList: aSADParameterList 		^aSADParameterList parameters		collect:			[:each | each accept: self]! !!SADSemanticAnalyzer methodsFor: 'visiting' stamp: 'WB 12/5/2025 09:02'!visitSADProcedure: aSADProcedure 		self env		declare: aSADProcedure identifier		method: aSADProcedure! !!SADSemanticAnalyzer methodsFor: 'visiting' stamp: 'WB 12/8/2025 15:49'!visitSADProcedureCall: aSADProcedureCall 		| proc procName args params |	args := aSADProcedureCall arguments accept: self.	[proc := self env methodNamed: aSADProcedureCall identifier.]		on: SADError		do: [:ex | 			self recordError: ex.			proc := SADErrorProcedure new.].	procName := proc identifier.	self env activate.	params := proc parameters accept: self.	[self apply: args to: params]		on: SADError		do: [:ex| self recordError: ex.].	proc methodBody accept: self.	self env deactivate.! !!SADSemanticAnalyzer methodsFor: 'visiting' stamp: 'WB 12/4/2025 12:34'!visitSADProgram: aSADProgram 		aSADProgram variables accept: self.	aSADProgram methods accept: self.	aSADProgram body accept: self.! !!SADSemanticAnalyzer methodsFor: 'visiting' stamp: 'WB 12/4/2025 15:52'!visitSADRelationalOp: aSADRelationalOp 		^aSADRelationalOp symbol! !!SADSemanticAnalyzer methodsFor: 'visiting' stamp: 'WB 12/4/2025 12:41'!visitSADTypeNode: aSADTypeNode 	^aSADTypeNode type! !!SADSemanticAnalyzer methodsFor: 'visiting' stamp: 'WB 12/4/2025 12:42'!visitSADVariableDeclaration: aSADVariableDeclaration 		| var |	var := SADVariable type: (aSADVariableDeclaration type accept: self).	[self env declare: aSADVariableDeclaration name variable: var]	on: SADError	do: [:ex| self recordError: ex].	^var! !!SADSemanticAnalyzer methodsFor: 'visiting' stamp: 'WB 12/5/2025 08:56'!visitSADVariableReference: aSADVariableReference 		| var |	var := [self env variableNamed: aSADVariableReference name]		on: SADError		do: 			[:ex | 			self recordError: ex. 			ex return: nil].	var isNil ifTrue: [^nil].	^var get! !!SADSemanticAnalyzer methodsFor: 'visiting' stamp: 'WB 12/4/2025 12:35'!visitSADVariables: aSADVariables 		aSADVariables variables		do:			[:each | each accept: self]! !!SADSemanticAnalyzer methodsFor: 'visiting' stamp: 'WB 12/8/2025 15:33'!visitSADWhileStatement: aSADWhileStatement 	[(aSADWhileStatement expression accept: self)		ifTrue: [aSADWhileStatement statement accept: self]]		on: NonBooleanReceiver		do: [:ex | self recordError: ex ].! !!SADSemanticAnalyzer methodsFor: 'visiting' stamp: 'WB 12/8/2025 13:08'!visitSADliteralBoolean: aSADliteralBoolean 	^ aSADliteralBoolean value! !!SADSemanticAnalyzer methodsFor: 'visiting' stamp: 'WB 12/4/2025 15:36'!visitSADliteralInteger: aSADliteralInteger 		^aSADliteralInteger value! !!SADSemanticAnalyzer methodsFor: 'visiting' stamp: 'WB 12/8/2025 11:59'!visitSADliteralString: aSADliteralString 		^aSADliteralString value! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!SADSemanticAnalyzer class	instanceVariableNames: ''!!SADSemanticAnalyzer class methodsFor: 'analyzing' stamp: 'WB 12/4/2025 12:31'!analyze: aProgramString	| ast analyzer |	ast := SADParser parse: aProgramString.	analyzer := self new.	ast accept: analyzer.	^analyzer errors.! !TestCase subclass: #SADSemanticAnalyzerTestCase	instanceVariableNames: ''	classVariableNames: ''	poolDictionaries: ''	category: 'SAD-SemanticAnalyzer'!!SADSemanticAnalyzerTestCase methodsFor: 'accessing' stamp: 'WB 12/4/2025 15:30'!arithmeticProgram	^'sadness 	reasons		count isa integer		n isa integer	do		:-(			count <- 9			n <- count + 1			count <- (((n +12) / (3 * 4)) - 3) mod 4		)-:'! !!SADSemanticAnalyzerTestCase methodsFor: 'accessing' stamp: 'WB 12/8/2025 15:43'!badArgsProgram	^'sadness 	sorrows		disfunction func(n isa integer) isa integer		do			writeNewLine	do		func()'! !!SADSemanticAnalyzerTestCase methodsFor: 'accessing' stamp: 'WB 12/5/2025 16:57'!badArithmeticProgram	^'sadness 	reasons		count isa integer		n isa integer	do		:-(			count <- 9			n <- count + "9"			count <- (((n +12) / (3 * 4)) - 3) mod 4		)-:'! !!SADSemanticAnalyzerTestCase methodsFor: 'accessing' stamp: 'WB 12/5/2025 13:27'!badConditionsProgram	^'sadnesssorrows	sob countdown()	reasons		count isa integer	do	:-(		count <- 10		while 2 do			:-(				writeInteger count				writeNewLine				count <- count - 1			)-:		if 2 then			writeNewLine	)-:do	countdown()'					! !!SADSemanticAnalyzerTestCase methodsFor: 'accessing' stamp: 'WB 12/8/2025 15:40'!badFunctionProgram	^'sadness 	sorrows		disfunction func(n isa integer) isa integer		do			func <- n * func()	do		writeNewLine'! !!SADSemanticAnalyzerTestCase methodsFor: 'accessing' stamp: 'WB 12/8/2025 13:09'!badOpProgram	^'sadness 	reasons		count isa integer		hi isa string		should isa boolean	do		:-(			count <- "hi"			hi <- 9			should <- 9		)-:'! !!SADSemanticAnalyzerTestCase methodsFor: 'accessing' stamp: 'WB 12/5/2025 13:39'!conditionsProgram	^'sadnesssorrows	sob countdown()	reasons		count isa integer	do	:-(		count <- 10		while count > 0 do			:-(				writeInteger count				writeNewLine				count <- count - 1			)-:		if count = 5 then			writeNewLine	)-:do	countdown()'					! !!SADSemanticAnalyzerTestCase methodsFor: 'accessing' stamp: 'WB 12/8/2025 13:12'!factorialProgram	^'sadness 	reasons		fact6 isa integer	sorrows		disfunction factorial(n isa integer) isa integer		do			if n = 0 then				factorial <- 1			else				factorial <- n * factorial(n - 1)	do		:-(			fact6 <- factorial(6)			writeString "factorial 6 is "			writeInteger fact6			writeNewLine		)-:'! !!SADSemanticAnalyzerTestCase methodsFor: 'accessing' stamp: 'WB 12/4/2025 15:30'!logicalProgram	^'sadness 	reasons		count isa integer		answer isa boolean	do		:-(			count <- 42			if true and not (3 = count) then				answer <- (count > 9) or (2 < count)		)-:'! !!SADSemanticAnalyzerTestCase methodsFor: 'accessing' stamp: 'WB 12/4/2025 16:32'!multipleFactorialProgram	^'sadness 	reasons		fact6 isa integer	sorrows		disfunction factorial(n isa integer) isa integer		do			if n = 0 then				factorial <- 1			else				factorial <- n * factorial(n - 1)						disfunction factorial(n isa integer) isa integer		do			if n = 0 then				factorial <- 1			else				factorial <- n * factorial(n - 1)	do		:-(			fact6 <- factorial(6)			writeString "factorial 6 is "			writeInteger fact6			writeNewLine		)-:'! !!SADSemanticAnalyzerTestCase methodsFor: 'accessing' stamp: 'WB 12/4/2025 12:23'!multipleVariablesProgram	^'sadness 	reasons		count isa integer		shouldI isa boolean		count isa string	do		writeNewLine'! !!SADSemanticAnalyzerTestCase methodsFor: 'accessing' stamp: 'WB 12/4/2025 12:38'!nanoProgram	^'sadness do writeNewLine'! !!SADSemanticAnalyzerTestCase methodsFor: 'accessing' stamp: 'WB 12/8/2025 13:08'!opProgram	^'sadness 	reasons		count isa integer		hi isa string		should isa boolean	do		:-(			count <- 9			hi <- "hi"			should <- true		)-:'! !!SADSemanticAnalyzerTestCase methodsFor: 'accessing' stamp: 'WB 12/4/2025 15:29'!procedureProgram	^'sadnesssorrows	sob countdown()	reasons		count isa integer	do	:-(		count <- 10		while count > 0 do			:-(				writeInteger count				writeNewLine				count <- count - 1			)-:		writeString "BLASTOFF!!"	)-:do	countdown()'					! !!SADSemanticAnalyzerTestCase methodsFor: 'accessing' stamp: 'WB 12/5/2025 09:04'!undeclaredProcedureProgram	^'sadnesssorrows	sob countdown()	reasons		count isa integer	do	:-(		count <- 10		while count > 0 do			:-(				writeInteger count				writeNewLine				count <- count - 1			)-:		writeString "BLASTOFF!!"	)-:do	countup()'					! !!SADSemanticAnalyzerTestCase methodsFor: 'accessing' stamp: 'WB 12/5/2025 08:52'!undelcaredVariablesProgram	^'sadness 	reasons		count isa integer		shouldI isa boolean	do		:-(			random <- 2			count <- other		)-:		'! !!SADSemanticAnalyzerTestCase methodsFor: 'accessing' stamp: 'WB 12/4/2025 15:31'!variablesProgram	^'sadness 	reasons		count isa integer		shouldI isa boolean		message isa string	do		writeNewLine'! !!SADSemanticAnalyzerTestCase methodsFor: 'running' stamp: 'WB 12/8/2025 13:05'!testArithmeticProgram		| errors |	errors := SADSemanticAnalyzer analyze: self arithmeticProgram.	self assert: 0 equals: errors size.	errors := SADSemanticAnalyzer analyze: self badArithmeticProgram.	self assert: 1 equals: errors size.! !!SADSemanticAnalyzerTestCase methodsFor: 'running' stamp: 'WB 12/8/2025 15:33'!testConditionsProgram		| errors |	errors := SADSemanticAnalyzer analyze: self conditionsProgram.	self assert: 0 equals: errors size.	errors := SADSemanticAnalyzer analyze: self badConditionsProgram.	self assert: 2 equals: errors size.! !!SADSemanticAnalyzerTestCase methodsFor: 'running' stamp: 'WB 12/8/2025 15:44'!testFunctionProgram		| errors |	errors := SADSemanticAnalyzer analyze: self factorialProgram.	self assert: 0 equals: errors size.	errors := SADSemanticAnalyzer analyze: self multipleFactorialProgram.	self assert: 1 equals: errors size.	errors := SADSemanticAnalyzer analyze: self badArgsProgram.	self assert: 1 equals: errors size.! !!SADSemanticAnalyzerTestCase methodsFor: 'running' stamp: 'WB 12/4/2025 12:40'!testNanoProgram		| errors |	errors := SADSemanticAnalyzer analyze: self nanoProgram.	self assert: 0 equals: errors size.! !!SADSemanticAnalyzerTestCase methodsFor: 'running' stamp: 'WB 12/8/2025 13:09'!testOpProgram		| errors |	errors := SADSemanticAnalyzer analyze: self opProgram.	self assert: 0 equals: errors size.	errors := SADSemanticAnalyzer analyze: self badOpProgram.	self assert: 3 equals: errors size.! !!SADSemanticAnalyzerTestCase methodsFor: 'running' stamp: 'WB 12/5/2025 09:37'!testProcedureProgram		| errors |	errors := SADSemanticAnalyzer analyze: self procedureProgram.	self assert: 0 equals: errors size.	errors := SADSemanticAnalyzer analyze: self undeclaredProcedureProgram.	self assert: 1 equals: errors size.! !!SADSemanticAnalyzerTestCase methodsFor: 'running' stamp: 'WB 12/5/2025 08:58'!testVariablesProgram		| errors |	errors := SADSemanticAnalyzer analyze: self variablesProgram.	self assert: 0 equals: errors size.	errors := SADSemanticAnalyzer analyze: self multipleVariablesProgram.	self assert: 1 equals: errors size.	errors := SADSemanticAnalyzer analyze: self undelcaredVariablesProgram.	self assert: 3 equals: errors size. "expects 3 because the varialbe reference type doesnt match as well"! !